<!-- plantilla QRS v0.1 -->
<!-- para usar sin citar autoria -->
<!-- al dominio publico. ( cc0 ) -->

<!DOCTYPE html>
<html lang="es">
  <head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.10.0/p5.min.js"></script>
		<title>qrs</title>
		<style>
			html, body {
				margin: 0;
				padding: 0;
				overflow: hidden;
				box-sizing: border-box;
				background-color: blueviolet;
			}

			#contenedor-canvas {
				width: 100vw;
				width: 100svw;
				height: 100vh;
				height: 100svh;

				display: flex;
  			justify-content: center;
  			align-items: center;

				background-color: aqua;
			}
		 </style>
  </head>
  <body>
    <main id="contenedor-canvas">
    </main>
    <script>

/////////////////////////////////////////////
// sketch plantilla qrs

let scroll = 0;
let scrollAcc = 0;

let touch = false;
let entrada_x, entrada_y;

/////////////////////////

function setup() {

	// medidas viewport
	let vpt_w = window.visualViewport?.width || window.innerWidth;
	let vpt_h = window.visualViewport?.height || window.innerHeight;

	// calculo canvas
	let cnv_w = 540; // mitad de 1080
	let cnv_h = cnv_w * vpt_h / vpt_w;
	
	createCanvas(cnv_w, cnv_h).parent("contenedor-canvas");
	windowResized(); // responsive
	
	console.log("vpt: ", floor(vpt_w), floor(vpt_h), floor(vpt_w / vpt_h));
	console.log("cnv: ", floor(cnv_w), floor(cnv_h), floor(cnv_w / cnv_h));

	background(140);
	textAlign(CENTER, CENTER);
	textSize(14);
	noStroke();
}

/////////////////////////

function draw() {
	
	// captura touch
	if (touch) {
		scroll = entrada_y - mouseY;
	}

	// fondo principal
	background(140, 6);

	// circulo fondo azul
	fill(140, 140, 220);
	circle(
		(frameCount % (width - 100)) + 50,
		(frameCount % (height - 100)) + 50,
		100
	);

	// circulo fondo rojo
	fill(220, 140, 140);
	circle(
		width - ((frameCount % (width - 100)) + 50),
		(frameCount % (height - 100)) + 50,
		100
	);

	// circulo fondo verde
	fill(140, 220, 140);
	circle(
		(frameCount % (width - 100)) + 50,
		height - ((frameCount % (height - 100)) + 50),
		100
	);

	// circulo fondo amarillo
	fill(220, 220, 140);
	circle(
		width - ((frameCount % (width - 100)) + 50),
		height - ((frameCount % (height - 100)) + 50),
		100
	);

	// circulos numerados
	push();
	for (let i = -6; i < 7; i++) {

		// circulo
		stroke(0)
		fill(220, 40 + i * 35, 215 - i * 35);
		circle(
			270,
			height * 0.5 + height * 0.25 * i - (touch ? scroll + scrollAcc : scrollAcc),
			100
		);

		// numero
		fill(255);
		noStroke();
		textSize(34);
		text(i, 270, height * 0.5 + height * 0.25 * i - (touch ? scroll + scrollAcc : scrollAcc) + 3)
	}
	pop();

	// fondo scroll
	fill(220, 200, 200);
	rect(
		420,
		height * 0.35 - scroll,
		100,
		height * 0.29
	);

	// texto scroll
	fill(0);
	text(
		"width: " + width +
		"\nheight: " + floor(height) +
		"\nscroll: " + floor(scroll),
		470, height * 0.5 - scroll
	);
}

/////////////////////////

let evitar_s = false;
function touchStarted() {

	// evitar doble accion
	if (evitar_s) return;
  evitar_s = true;
  setTimeout(function() {
    evitar_s = false;
  }, 200);

	// evitar fuera de pantalla
	if (
		mouseX < 0 ||
		mouseX > width ||
		mouseY < 0 ||
		mouseY > height
	) return;

	// guardar inicio touch
	entrada_x = mouseX;
	entrada_y = mouseY;

	// iniciar touch
	touch = true;
	background(160);
}

/////////////////////////

let evitar_e = false;
function touchEnded() {

	// evitar doble accion
	if (evitar_e) return;
  evitar_e = true;
  setTimeout(function() {
    evitar_e = false;
  }, 200);

	// teminar touch
	scrollAcc += scroll;
	touch = false;
	background(40);
}

/////////////////////////

function windowResized() {
  
  const cnv = document.getElementById("defaultCanvas0");
 
  if (windowWidth * height > windowHeight * width) {
    cnv.style.height = "100svh";
    cnv.style.width = (100 / height) * width + "svh";
  }
  else {
    cnv.style.width = "100vw";
    cnv.style.height = (100 / width) * height + "vw";
  }
}
//
/////////////////////////////////////////////

		</script>
  </body>
</html>
